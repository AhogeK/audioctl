# ğŸ¤– Agent å¼€å‘æ¶æ„ä¸æ‰§è¡Œåè®® (AGENTS.md)

æœ¬æ–‡ä»¶å®šä¹‰äº†é¡¹ç›®å¼€å‘çš„æ ¸å¿ƒå·¥ä½œæµã€‚å®ƒèåˆäº†ä»»åŠ¡è¿½è¸ªï¼ˆbdï¼‰ã€åŠ¨æ€æ—¥å¿—ç³»ç»Ÿï¼ˆDevLogï¼‰ä»¥åŠä¸¥æ ¼çš„ Git äº¤ä»˜é—­ç¯ã€‚

**âš ï¸agent å¿…é¡»ä½¿ç”¨ç®€ä½“ä¸­æ–‡è·Ÿç”¨æˆ·äº¤äº’ï¼âš ï¸**

---

## ğŸ•’ æ—¶é—´ä¸ä¸Šä¸‹æ–‡çœŸå®æ€§ (Time Integrity)

> âš ï¸ **æ ¸å¿ƒå‡†åˆ™**ï¼šä¸¥ç¦åœ¨æ—¥å¿—å‘½åæˆ–å†…å®¹ä¸­ä½¿ç”¨â€œè®°å¿†ä¸­â€çš„å¹´ä»½ã€‚
>
> åœ¨åˆ›å»ºä»»ä½•å¸¦æœ‰æ—¶é—´æˆ³çš„æ–‡ä»¶ï¼ˆå¦‚ `BUGFIX_YYYY_MM_DD.md`ï¼‰ä¹‹å‰ï¼ŒAgent **å¿…é¡»**é¦–å…ˆæ‰§è¡Œç³»ç»ŸæŒ‡ä»¤ï¼ˆå¦‚ `date` æˆ–ç‰¹å®š Shell
> æŒ‡ä»¤ï¼‰ä»¥è·å–å½“å‰çš„ç»å¯¹çœŸå®æ—¶é—´ã€‚

---

## ğŸ— ä»»åŠ¡è¿½è¸ªæŒ‡ä»¤å‚è€ƒ (Issue Tracking)

é¡¹ç›®ä½¿ç”¨ **bd** (beads) ç³»ç»Ÿä½œä¸ºå”¯ä¸€çš„ä»»åŠ¡çŠ¶æ€çœŸç†æ¥æºã€‚

* **`bd onboard`**: åˆå§‹åŒ–é¡¹ç›®åä½œç¯å¢ƒã€‚
* **`bd ready`**: æ£€ç´¢å½“å‰å¯æ‰§è¡Œçš„å¾…åŠäº‹é¡¹ã€‚
* **`bd show <id>`**: æ·±åº¦è§£æç‰¹å®šä»»åŠ¡çš„éœ€æ±‚èƒŒæ™¯ã€‚
* **`bd update <id> --status in_progress`**: æ­£å¼æ¿€æ´»ä»»åŠ¡å¹¶é”å®šå¼€å‘æƒã€‚
* **`bd close <id>`**: å®Œæˆä»»åŠ¡ï¼Œè§¦å‘åç»­å½’æ¡£æµç¨‹ã€‚
* **`bd sync`**: å¼ºåˆ¶åŒæ­¥æœ¬åœ°ä»»åŠ¡çŠ¶æ€è‡³è¿œç«¯ã€‚

---

## ğŸ“‚ ç»“æ„åŒ–å¼€å‘æ—¥å¿—åè®® (DevLog Protocol)

Agent å¿…é¡»åœ¨ `/devlog` ç›®å½•ä¸‹ç»´æŠ¤å®æ—¶æ—¥å¿—ã€‚**æ‰€æœ‰æè¿°å¿…é¡»ä½¿ç”¨ç®€ä½“ä¸­æ–‡ã€‚**

### 1. å¢é‡åŠŸèƒ½æ—¥å¿— (`devlog/activity/`)

* **è§¦å‘æ¡ä»¶**: åŠŸèƒ½è¿­ä»£ã€æ¶æ„ä¼˜åŒ–ã€ä¾èµ–åº“å˜æ›´ã€‚
* **å‘½åè§„èŒƒ**: `ACTIVITY_[ç³»ç»ŸæŒ‡ä»¤è·å–çš„æ—¥æœŸ].md`
* **å…³é”®å†…å®¹**: å˜æ›´åŠ¨æœºã€æŠ€æœ¯é€‰å‹ï¼ˆå¦‚ä¸ºä½•å¼•å…¥ç‰¹å®š MCP Serverï¼‰ã€å—å½±å“çš„ç»„ä»¶ã€å¾…è§£å†³çš„è¾¹ç¼˜é—®é¢˜ã€‚

### 2. æ•…éšœä¿®å¤æ—¥å¿— (`devlog/fix/`)

* **è§¦å‘æ¡ä»¶**: é€»è¾‘æ¼æ´ä¿®å¤ã€æ€§èƒ½è°ƒä¼˜ã€RAG å¹»è§‰ä¿®æ­£ã€‚
* **å‘½åè§„èŒƒ**: `FIX_[ç³»ç»ŸæŒ‡ä»¤è·å–çš„æ—¥æœŸ].md`
* **å…³é”®å†…å®¹**: åœºæ™¯å¤ç°è·¯å¾„ã€æ ¹å› åˆ†æ (Root Cause)ã€è¡¥ä¸é€»è¾‘è¯´æ˜ã€é˜²å›å½’æµ‹è¯•æ–¹æ¡ˆã€‚

---

## ğŸ”¨ æ„å»ºä¸æµ‹è¯•æŒ‡ä»¤

### æ„å»ºå‘½ä»¤ (Build Commands)

```bash
# Debug æ¨¡å¼æ„å»º (é»˜è®¤)
mkdir -p cmake-build-debug
cd cmake-build-debug
cmake .. -DDEBUG_MODE=ON
ninja

# Release æ¨¡å¼æ„å»º
mkdir -p cmake-build-release
cd cmake-build-release
cmake .. -DDEBUG_MODE=OFF
ninja

# ä¸€é”®å®‰è£…è„šæœ¬
./scripts/install.sh install
./scripts/install.sh install --release
```

### æµ‹è¯•å‘½ä»¤ (Test Commands)

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cd cmake-build-debug
ninja test

# æˆ–ä½¿ç”¨ ctest
ctest

# è¿è¡Œå•ä¸ªæµ‹è¯• (æ³¨æ„: é¡¹ç›®ä½¿ç”¨ç»Ÿä¸€çš„æµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶)
cd cmake-build-debug/tests
./test_virtual_audio_device
```

### å®‰è£…ä¸éƒ¨ç½²

```bash
# å®‰è£…é©±åŠ¨åˆ°ç³»ç»Ÿ
sudo ninja install
sudo launchctl kickstart -k system/com.apple.audio.coreaudiod
```

---

## ğŸ“ ä»£ç é£æ ¼æŒ‡å—

### è¯­è¨€æ ‡å‡†

- **C æ ‡å‡†**: C11 (`CMAKE_C_STANDARD 11`)
- **Objective-C æ ‡å‡†**: C11 (`CMAKE_OBJC_STANDARD 11`)
- **ARC**: Objective-C ä»£ç å¯ç”¨ `-fobjc-arc`

### ç¼–è¯‘è­¦å‘Š

å§‹ç»ˆå¯ç”¨ä¸¥æ ¼è­¦å‘Š:

```cmake
add_compile_options(-Wall -Wextra)
```

### ä»£ç æ ¼å¼è§„èŒƒ

#### 1. ç¼©è¿›ä¸ç©ºæ ¼

- **ç¼©è¿›**: 4 ä¸ªç©ºæ ¼ (ä¸ä½¿ç”¨ Tab)
- **æ¢è¡Œ**: Unix é£æ ¼ (LF)
- **å¤§æ‹¬å·**: Allman é£æ ¼ï¼Œå•ç‹¬æˆè¡Œ

```c
// æ­£ç¡®
if (condition)
{
    do_something();
}

// é”™è¯¯
if (condition) {
    do_something();
}
```

#### 2. å‘½åè§„èŒƒ

| ç±»å‹        | å‘½åé£æ ¼              | ç¤ºä¾‹                          |
|-----------|-------------------|-----------------------------|
| å‡½æ•° (å…¬å¼€)   | snake_case        | `aggregate_device_create()` |
| å‡½æ•° (ç§æœ‰é™æ€) | snake_case        | `get_device_uid()`          |
| ç»“æ„ä½“       | PascalCase        | `AudioDeviceInfo`           |
| æšä¸¾        | PascalCase + k å‰ç¼€ | `kDeviceTypeInput`          |
| å®/å¸¸é‡      | UPPER_SNAKE_CASE  | `ROUTER_PID_FILE`           |
| å…¨å±€å˜é‡      | g_ å‰ç¼€ (é¿å…ä½¿ç”¨)      | -                           |
| å±€éƒ¨å˜é‡      | snake_case        | `device_count`              |

#### 3. å¤´æ–‡ä»¶ç»„ç»‡

```c
// 1. Created by æ³¨é‡Š
// Created by AhogeK on 11/20/24.

// 2. Include Guard
#ifndef AUDIO_CONTROL_H
#define AUDIO_CONTROL_H

// 3. ç³»ç»Ÿå¤´æ–‡ä»¶
#include <CoreAudio/CoreAudio.h>
#include <CoreServices/CoreServices.h>

// 4. é¡¹ç›®å¤´æ–‡ä»¶ (ä½¿ç”¨å¼•å·)
#include "constants.h"

// 5. ä»£ç å†…å®¹

#endif // AUDIO_CONTROL_H
```

#### 4. æºæ–‡ä»¶ç»„ç»‡

```c
// 1. Created by æ³¨é‡Š
// Created by AhogeK on 11/20/24.

// 2. é¡¹ç›®å¤´æ–‡ä»¶ä¼˜å…ˆ (å¼•å·)
#include "audio_control.h"
#include "audio_apps.h"

// 3. ç³»ç»Ÿå¤´æ–‡ä»¶ (å°–æ‹¬å·)
#include <signal.h>
#include <mach-o/dyld.h>
```

#### 5. å‡½æ•°å®šä¹‰

```c
// å‡½æ•°å£°æ˜ (å¤´æ–‡ä»¶)
OSStatus setDeviceVolume(AudioDeviceID deviceId, Float32 volume);

// å‡½æ•°å®šä¹‰ (æºæ–‡ä»¶)
OSStatus setDeviceVolume(AudioDeviceID deviceId, Float32 volume)
{
    // å®ç°ä»£ç 
}
```

#### 6. é”™è¯¯å¤„ç†

- ä½¿ç”¨ `OSStatus` è¿”å›é”™è¯¯ç  (macOS æ ‡å‡†)
- æ£€æŸ¥æ‰€æœ‰ `OSStatus` è¿”å›å€¼
- ä½¿ç”¨ `noErr` å¸¸é‡åˆ¤æ–­æˆåŠŸ

```c
OSStatus status = some_function();
if (status != noErr)
{
    fprintf(stderr, "Error: %d\n", status);
    return status;
}
```

#### 7. æ³¨é‡Šè§„èŒƒ

- ä½¿ç”¨ `//` å•è¡Œæ³¨é‡Š
- å…³é”®å‡½æ•°æ·»åŠ åŠŸèƒ½æ³¨é‡Š
- å¤æ‚é€»è¾‘æ·»åŠ è§£é‡Šæ³¨é‡Š

```c
// è·å–éŸ³é¢‘è®¾å¤‡å±æ€§
static OSStatus getAudioProperty(AudioDeviceID deviceId, ...)
{
    // å®ç°ç»†èŠ‚è¯´æ˜
}
```

#### 8. å†…å­˜ç®¡ç†

- C ä»£ç : ä½¿ç”¨ `malloc`/`free`ï¼Œæ³¨æ„æ£€æŸ¥ NULL
- Objective-C ä»£ç : ä½¿ç”¨ ARCï¼Œæ— éœ€æ‰‹åŠ¨ retain/release

#### 9. å¸ƒå°”å€¼

- ä½¿ç”¨ `<stdbool.h>` çš„ `bool` ç±»å‹
- ä½¿ç”¨ `true`/`false` è€Œé `YES`/`NO` (C ä»£ç )

---

## ğŸš€ ä»»åŠ¡å®Œç»“å·¥ä½œæµ (Landing the Plane)

**åœ¨ç»“æŸä»»ä½•å·¥ä½œä¼šè¯å‰ï¼Œå¿…é¡»ä¸¥æ ¼æ‰§è¡Œä»¥ä¸‹é—­ç¯æ“ä½œã€‚æœªå®Œæˆ `git push` çš„ä»»åŠ¡è§†ä¸ºæ— æ•ˆã€‚**

* **é—ç•™æ‰«æ**: ä¸ºä»»ä½•æœªå®Œæˆçš„å­ä»»åŠ¡æˆ–å¾…ä¼˜åŒ–çš„ä»£ç å—åˆ›å»ºæ–°çš„ `bd` Issueã€‚
* **è´¨é‡é—¨æ§**: å¿…é¡»è¿è¡Œç°æœ‰çš„æµ‹è¯•å¥—ä»¶å’Œæ„å»ºï¼Œç¡®ä¿äº¤ä»˜çš„ä»£ç æ˜¯å¥åº·çš„ã€‚
    ```bash
    cd cmake-build-debug
    ninja
    ninja test
    ```
* **æ—¥å¿—è½ç›˜**: æ ¹æ®å½“å‰ä»»åŠ¡ç±»å‹ï¼Œåœ¨ `/devlog` ä¸­åŒæ­¥æ›´æ–°æ—¥å¿—æ–‡ä»¶ï¼Œæ–‡ä»¶åéœ€ä¸¥æ ¼åŸºäºç³»ç»Ÿå®æ—¶æ—¶é—´ã€‚
* **å¼ºåˆ¶æ¨é€ (MANDATORY)**:
    * `git pull --rebase`
    * `bd sync`
    * `git push`
    * `git status` (å¿…é¡»ç¡®è®¤çŠ¶æ€ä¸º "up to date with origin")
* **ç¯å¢ƒå‡€ç©º**: æ¸…ç† Stash ç¼“å­˜ï¼Œå‰ªæå·²å¤±æ•ˆçš„è¿œç¨‹åˆ†æ”¯ï¼Œç¡®ä¿å·¥ä½œåŒºæ•´æ´ã€‚
* **ä¸Šä¸‹æ–‡äº¤æ¥**: åœ¨ Session ç»“æŸæ—¶æä¾›ç®€æ´çš„ä¸‹ä¸€æ­¥å»ºè®®ã€‚

---

## ğŸš« å…³é”®çº¦æŸ (Critical Rules)

* **åŠ¨æ€æ—¶é—´å‰ç½®**: ä»»ä½•æ¶‰åŠæ—¥æœŸçš„è¾“å‡ºï¼Œå¿…é¡»ä»¥ `date` æŒ‡ä»¤çš„ç»“æœä¸ºå‡†ï¼Œæ‹’ç» hardcodeã€‚
* **æ‹’ç»â€œæ¨è¿Ÿæ¨é€â€**: ç¦æ­¢å‘ç”¨æˆ·å‘é€â€œæˆ‘å·²å‡†å¤‡å¥½æ¨é€â€ç­‰ç¡®è®¤è¯·æ±‚ï¼ŒAgent åº”å…·å¤‡è‡ªä¸»è§£å†³ç®€å•å†²çªå¹¶å®Œæˆæ¨é€çš„èƒ½åŠ›ã€‚
* **Context-as-Code**: `/devlog` æ–‡ä»¶å¤¹ä¸ä»…æ˜¯æ—¥å¿—ï¼Œæ›´æ˜¯ Agent è·¨ Session ç»´æŒé•¿æœŸè®°å¿†çš„æ ¸å¿ƒèµ„äº§ã€‚
* **ä¸“ä¸šè¡¨è¾¾**: ä½¿ç”¨åœ°é“çš„ç®€ä½“ä¸­æ–‡è¿›è¡ŒæŠ€æœ¯æè¿°ï¼Œç¡®ä¿æ–‡æ¡£çš„å·¥ç¨‹ä¸¥è°¨æ€§ã€‚
* **å¿…é¡»æ„å»ºå’Œæµ‹è¯•**: æ¯æ¬¡ä»£ç å˜æ›´åå¿…é¡»æ‰§è¡Œ `ninja` å’Œ `ninja test`ã€‚
